import pyautogui
import time
import os  # ì´ë¯¸ì§€ íŒŒì¼ ê²½ë¡œë¥¼ ì •í™•íˆ ì°¾ê¸° ìœ„í•´ í•„ìš”í•©ë‹ˆë‹¤.

# ----------------------------------------------------------------------
# 1. ì¢Œí‘œ ì„¤ì • (ì‚¬ìš©ìì˜ í™”ë©´ í™˜ê²½ì— ë§ê²Œ ì¡°ì •ëœ ì¢Œí‘œ)
# ----------------------------------------------------------------------
BUTTON_COORDS = {
    '1': (1200, 650), 
    '9': (1346, 510),
    '0': (1270, 720),
    '+': (1415, 654),
    '-': (1415, 584),
    '=': (1415, 730),
    'C': (1270, 445),
    'Result_Region': (1670, 200) # ê²°ê³¼ ê°’ì´ ë‚˜íƒ€ë‚˜ëŠ” ì˜ì—­ (ì´ë¯¸ì§€ ì¸ì‹ ë²”ìœ„)
}

# ëª¨ë“  ë™ì‘ ì‚¬ì´ì— 0.3ì´ˆì˜ ê°„ê²©ì„ ë‘ì–´ ì•ˆì •ì„±ì„ ë†’ì…ë‹ˆë‹¤.
pyautogui.PAUSE = 0.3 

# ----------------------------------------------------------------------
# 2. ê¸°ëŠ¥ í•¨ìˆ˜ ì •ì˜
# ----------------------------------------------------------------------

def click_button(key):
    """ì§€ì •ëœ ë²„íŠ¼ ì¢Œí‘œë¥¼ í´ë¦­í•©ë‹ˆë‹¤."""
    x, y = BUTTON_COORDS.get(key)
    if x and y:
        pyautogui.click(x, y)
    else:
        print(f"ì˜¤ë¥˜: ë²„íŠ¼ '{key}'ì˜ ì¢Œí‘œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")

def clear_calculator():
    """ê³„ì‚°ê¸°ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤ (C ë²„íŠ¼ í´ë¦­)."""
    print("--- ê³„ì‚°ê¸° ì´ˆê¸°í™” (C ë²„íŠ¼ í´ë¦­) ---")
    click_button('C')
    time.sleep(1) # ì•± ë°˜ì‘ì„ ìœ„í•œ ëŒ€ê¸°

def run_boundary_test(test_name, input_sequence, expected_result):
    """
    ê²½ê³„ê°’ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ í•˜ë‚˜ë¥¼ ì‹¤í–‰í•˜ê³  ì´ë¯¸ì§€ë¡œ ê²°ê³¼ë¥¼ ê²€ì¦í•©ë‹ˆë‹¤.
    """
    print(f"\n" + "="*40)
    print(f"í…ŒìŠ¤íŠ¸ ì‹œì‘: {test_name}")
    clear_calculator()

    print(f"ì…ë ¥ ì‹œí€€ìŠ¤: {input_sequence}")
    for key in input_sequence:
        click_button(key)
    
    # ê³„ì‚° ê²°ê³¼ê°€ í™”ë©´ì— ëœ° ë•Œê¹Œì§€ ì ì‹œ ëŒ€ê¸°
    time.sleep(1.5) 

    # ------------------------------------------------------------------
    # ğŸŒŸ ì´ë¯¸ì§€ ì¸ì‹ ê²½ë¡œ ìµœì í™”: ìŠ¤í¬ë¦½íŠ¸ ìœ„ì¹˜ ê¸°ì¤€ìœ¼ë¡œ ì´ë¯¸ì§€ ì°¾ê¸°
    # ------------------------------------------------------------------
    # ì´ ì½”ë“œê°€ ìˆëŠ” í´ë” ê²½ë¡œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
    base_path = os.path.dirname(__file__) 
    # ì´ë¯¸ì§€ íŒŒì¼ì˜ ì „ì²´ ì ˆëŒ€ ê²½ë¡œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    image_file = os.path.join(base_path, f"{expected_result}.png")
    
    try:
        # ì´ë¯¸ì§€ ì¸ì‹ ì‹œë„ (OpenCVê°€ ì„¤ì¹˜ë˜ì—ˆìœ¼ë¯€ë¡œ confidence ì‚¬ìš© ê°€ëŠ¥)
        # region ì •ë³´ëŠ” í˜„ì¬ í™”ë©´ êµ¬ì„±ì— ë§ê²Œ (x, y, width, height) ì¡°ì •ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        result_location = pyautogui.locateOnScreen(image_file, confidence=0.8) 
        
        if result_location:
            print(f"âœ… ê²€ì¦ ì„±ê³µ: í™”ë©´ì—ì„œ ê¸°ëŒ€ ê²°ê³¼ '{expected_result}' ì´ë¯¸ì§€ë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤.")
        else:
            print(f"âŒ ê²€ì¦ ì‹¤íŒ¨: í™”ë©´ì—ì„œ ê¸°ëŒ€ ê²°ê³¼ '{expected_result}' ì´ë¯¸ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")

    except Exception as e:
        print(f"âš ï¸ ì´ë¯¸ì§€ ì¸ì‹ ì˜¤ë¥˜: {e}")
        print(f"ğŸ’¡ í™•ì¸: '{image_file}' íŒŒì¼ì´ ì‹¤ì œ ê²½ë¡œì— ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.")
    
    print(f"í…ŒìŠ¤íŠ¸ ì¢…ë£Œ: {test_name}")
    print("="*40)


# ----------------------------------------------------------------------
# 3. í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‹¤í–‰ë¶€
# ----------------------------------------------------------------------

if __name__ == "__main__":
    # ì‹œì‘ ì „ 2ì´ˆê°„ ëŒ€ê¸°í•˜ì—¬ ì‚¬ìš©ìê°€ ê³„ì‚°ê¸° ì°½ì„ ë„ìš¸ ì‹œê°„ì„ ì¤ë‹ˆë‹¤.
    print("3ì´ˆ ë’¤ í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤. ì•„ì´í° ë¯¸ëŸ¬ë§ ì°½ì„ ë„ì›Œì£¼ì„¸ìš”.")
    time.sleep(3)

    # ì¼€ì´ìŠ¤ 1: ìµœëŒ€ ìë¦¿ìˆ˜ ê²½ê³„ê°’ í…ŒìŠ¤íŠ¸ (9999999 + 1 = 10000000)
    test_1_sequence = ['9']*7 + ['+'] + ['1'] + ['=']
    run_boundary_test("BVT 1 (ìµœëŒ€ ìë¦¿ìˆ˜)", test_1_sequence, "10000000")

    # ì¼€ì´ìŠ¤ 2: ìµœì†Œ ì–‘ìˆ˜ ì—°ì‚° í…ŒìŠ¤íŠ¸ (1 - 1 = 0)
    test_2_sequence = ['1', '-', '1', '=']
    run_boundary_test("BVT 2 (ìµœì†Œ ì—°ì‚°)", test_2_sequence, "0")

    # ì¼€ì´ìŠ¤ 3: ë³µí•© ì—°ì‚° ê²½ê³„ê°’ (1 + 0 - 1 = 0)
    test_3_sequence = ['1', '+', '0', '-', '1', '=']
    run_boundary_test("BVT 3 (ì—°ì‚°ì ì¡°í•©)", test_3_sequence, "0")